# L3_Teacher_v0.11

## 0. Scope
Техническая спецификация сценариев Teacher. Заменяет L3_Teacher_v0.10. Общие контракты — L3_Common_v0.11.

---
## 1. Расписание и слоты
- Создание/редактирование слотов с валидацией вместимости и пересечений.
- Пресеты применяются **атомарно**: либо весь пакет изменений применяется, либо откатывается.
- Все операции идут через короткие `op` и `state_store` (см. Callback codec).

**Аудит:**
- `TEACHER_SLOT_APPLY_BATCH` (atomic), payload: список изменений, результат {ok|error,code?}.

---
## 2. Назначения и материалы
- Доступ/публикация материалов недели (read-only если владелец — Owner).
- Учёт связей `assignment ↔ week`.

**Аудит:**
- `TEACHER_ASSIGNMENT_CREATE/UPDATE/DELETE`
- `TEACHER_MATERIAL_LINK_SET/UNSET`

---
## 3. Оценки
- Установка/изменение оценок с аудитом `TEACHER_GRADE_SET`.
- Валидация диапазона/типов (целые/буквенные — по политике курса).
- Массовые выставления делаются батчами; при ошибке часть неуспешных строк возвращается в отчёт.

---
## 4. Callback и StateStore
- Все интеракции — через `"{op}:{key}"` (где `key` — 12‑символьный hex из `uuid4().hex[:12]`).
- Никаких JSON в callback_data; параметры — в `state_store.params`.
- TTL 15 минут, после истечения — `E_STATE_EXPIRED`.

---
## 5. Формат времени и лимиты файлов
- Отображаем даты/время только форматом из L3_Common §2.
- Лимиты файлов/расширения см. L3_Common §6.

---
## 6. Ошибки Teacher (дополнение)
- `E_SLOT_CONFLICT`, `E_SLOT_CAPACITY_EXCEEDED`
- `E_ASSIGNMENT_INVALID`
- `E_GRADE_INVALID_VALUE`
